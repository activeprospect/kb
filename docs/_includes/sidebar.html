<nav class="sidebar">
  <button class="sidebar-toggle" onclick="toggleSidebar()">
    <svg width="20" height="20" viewBox="0 0 20 20">
      <path d="M3 5h14M3 10h14M3 15h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </button>
  
  <div class="sidebar-content">
    <div class="sidebar-header">
      <h3><a href="{{ site.baseurl }}/">Documentation</a></h3>
    </div>
    
    <ul class="nav-list">
      {% for section in site.data.navigation.docs %}
        <li class="nav-item {% if page.url contains section.url %}active expanded{% endif %}">
          <div class="nav-item-wrapper">
            {% if section.children %}
              <button class="nav-toggle" onclick="toggleSection(this)" aria-label="Toggle section">
                <svg width="10" height="10" viewBox="0 0 10 10">
                  <path d="M2 3l3 3 3-3" stroke="currentColor" stroke-width="1.5" fill="none"/>
                </svg>
              </button>
            {% endif %}
            
            {% if section.url %}
              <a href="{{ site.baseurl }}{{ section.url }}" class="nav-link section-link">{{ section.title }}</a>
            {% else %}
              <span class="nav-link section-link">{{ section.title }}</span>
            {% endif %}
          </div>
          
          {% if section.children %}
            <ul class="nav-children" style="{% unless page.url contains section.url %}display: none;{% endunless %}">
              {% for child in section.children %}
                <li class="nav-child {% if page.url == child.url %}active{% endif %}">
                  {% if child.url %}
                    <a href="{{ site.baseurl }}{{ child.url }}" class="nav-link">{{ child.title }}</a>
                  {% else %}
                    <span class="nav-link subsection">{{ child.title }}</span>
                  {% endif %}
                  
                  {% if child.children %}
                    <ul class="nav-grandchildren">
                      {% for grandchild in child.children %}
                        <li class="nav-grandchild {% if page.url == grandchild.url %}active{% endif %}">
                          <a href="{{ site.baseurl }}{{ grandchild.url }}" class="nav-link">{{ grandchild.title }}</a>
                        </li>
                      {% endfor %}
                    </ul>
                  {% endif %}
                </li>
              {% endfor %}
            </ul>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  </div>
</nav>

<script>
  function toggleSection(button) {
    const navItem = button.closest('.nav-item');
    const children = navItem.querySelector('.nav-children');
    const isExpanded = navItem.classList.contains('expanded');
    
    if (isExpanded) {
      navItem.classList.remove('expanded');
      children.style.display = 'none';
    } else {
      navItem.classList.add('expanded');
      children.style.display = 'block';
    }
  }
  
  function toggleSidebar() {
    const sidebar = document.querySelector('.sidebar');
    sidebar.classList.toggle('collapsed');
  }
  
  // Auto-expand active sections on page load
  document.addEventListener('DOMContentLoaded', function() {
    const activeItems = document.querySelectorAll('.nav-item.active');
    activeItems.forEach(item => {
      const children = item.querySelector('.nav-children');
      if (children && children.style.display === 'none') {
        item.classList.add('expanded');
        children.style.display = 'block';
      }
    });
  });
</script>